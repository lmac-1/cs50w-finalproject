{% extends "danceapp/layout.html" %}
{% load static %}

{% block title %}Home {% endblock %}

{% block body %}
    <nav class="navbar navbar-expand-lg navbar-light d-flex justify-content-center">
        <div class="d-flex">
            
            <button class="btn" type="button" id="filter-toggle">
                <i class="fas fa-filter"></i>
            </button>

            <div id="titleContainer" class="form-inline">
                <div class="input-group">
                    <input type="search" class="form-control" placeholder="Search title" aria-label="Search title" id="title_input">
                    <div class="input-group-append">
                        <button class="btn btn-search" type="button" id="search_title">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="row justify-content-center">
        <!-- FILTERS SIDE BAR -->
        <div id="filter-container" class="filters-sidebar d-none mx-auto">
            <!-- Style -->
            <div class="form-group filter-section">
                <div class="filter-label">Style</div>
                <select class="form-control" id="search_style">
                    <option value="" selected>All</option>
                    {% for style in styles %}
                    <option value="{{ style.pk }}">{{ style.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <!-- Teacher -->
            <div class="form-group filter-section">
                <div class="filter-label">Teacher</div>
                <select class="form-control" id="search_teacher">
                    <option value="" selected>All</option>
                    {% for teacher in teachers %}
                    <option value="{{ teacher.pk }}">{{ teacher.user.first_name }}</option>
                    {% endfor %}
                </select>
            </div>
            <!-- Level -->
            <div class="form-group filter-section">
                
                <div class="filter-label">Level</div>
                <select class="form-control" id="search_level">
                    <option value="" selected>All</option>
                    {% for value, level in levels %}
                    <option value="{{ value }}">{{level}}</option>
                    {% endfor %}
                </select>
            </div>
            
        </div>

        <div class="d-flex flex-wrap justify-content-center align-items-center col-12 col-lg-10 containerVideos" id="videoContainer">
            {% for video in videos %}
                <a class="text-decoration-none" href="{% url 'video' video.pk %}">
                    
                    <div class="card m-2 text-dark card-box-shadow border-0" style="width: 18rem;">
                        
                            <img src="{{ video.thumbnail_url }}" class="card-img-top card-thumbnail" alt="Image for {{ video.title }}">
                        
                            <div class="card-homepage card-body">
                            
                                <div class="card-video-title card-text font-weight-bold text-left d-flex align-items-center px-3">
                                    {{ video.title }}
                                </div>
                                <div class="card-subtext d-flex justify-content-between align-items-center px-3 bg-light">
                                    <div><i class="far fa-calendar-alt"></i> {{ video.class_date|date:"d/m/y"}} </div>
                                    <div><i class="fab fa-deezer"></i> {{ video.get_level_display }}</div>
                                    <div class="d-flex flex-column justify-content-center align-items-center">
                                        {% for teacher in video.teacher.all %}
                                            <div class="pb"><i class="fas fa-user pr-1"></i>{{ teacher }}</div>
                                        {% endfor %}</div>
                                </div>    
                            </div>

                    </div>
                </a>
            {% endfor %}
        </div>    
        
    </div>
    <script type="text/javascript">
        window.onresize = screenWidth;
        window.onload = screenWidth;
        
        function screenWidth() {
            let filterContainer = document.getElementById('filter-container');
            let teacherFilter = document.getElementById('search_teacher').value;
            let levelFilter = document.getElementById('search_level').value;
            let styleFilter = document.getElementById('search_style').value;

            if (window.innerWidth <= 1199) {
                
                // Switching between side bar and central filter view
                if (filterContainer.classList.contains('filters-sidebar')) {
                    filterContainer.classList.remove('mx-auto');
                    filterContainer.classList.remove('filters-sidebar');
                    filterContainer.classList.remove('d-block');
                    
                    // Only hide filters in transition if none have been applied
                    if (styleFilter == '' && levelFilter == '' && teacherFilter == '') {
                        filterContainer.classList.add('d-none');
                    }
                    
                    
                }
                // Only adds d-flex property if not already set to be hidden
                if (!filterContainer.classList.contains('d-none')) {
                    filterContainer.classList.add('d-flex');
                }
                
            } else {
                filterContainer.classList.remove('d-flex');
                filterContainer.classList.remove('d-none');
                filterContainer.classList.add('d-block');
                filterContainer.classList.add('filters-sidebar');
                filterContainer.classList.add('mx-auto');
            }
        }    
    </script>
{% endblock %}


{% block script %}
<script src="{% static 'danceapp/videos.js' %}"></script>
{% endblock %}